

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Bsmslwx">
  <meta name="keywords" content="">
  
  <title>传输介质,以太网帧,IP编码 ~ BsmslwxBlog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":80,"cursorChar":".","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Bsmslwx</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/bg4.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="传输介质,以太网帧,IP编码">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-07-15 21:37" pubdate>
        2021年7月15日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      6.9k 字
    </span>
  

  

  
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">传输介质,以太网帧,IP编码</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2021年7月21日 下午
                
              </p>
            
            <div class="markdown-body">
              <h1 id="传输介质-以太网帧-IP编码"><a href="#传输介质-以太网帧-IP编码" class="headerlink" title="传输介质,以太网帧,IP编码"></a>传输介质,以太网帧,IP编码</h1><p>具体内容如题</p>
<h2 id="1-传输介质简介"><a href="#1-传输介质简介" class="headerlink" title="1.传输介质简介"></a>1.传输介质简介</h2><p>简单网络：两个终端，用一条能承载数据传输的物理介质(也称传输介质)连接起来。</p>
<p>关于网络：</p>
<ul>
<li>终端相互传递信息和资源共享的需求是网络产生的主要原因</li>
<li>终端可以产生、发送和接受数据，网络是终端建立通信的媒介，终端通过网络建立连接。其中用来传输数据的载体成为介质，网络可以使用各种介质进行数据传输，包括物理线缆，无线电波等</li>
<li>网络就是通过介质把终端互连而成的一个规模大、功能强的系统，从而使得众多的终端可以方便地互相传递信息，共享信息资源</li>
</ul>
<p>下面是对于各种介质的简单介绍</p>
<ol>
<li><p>同轴电缆</p>
<ul>
<li>同轴电缆是早期使用的传输介质，标准有两种：10BASEE2和10BASE5，均支持10Mbps的传输速率，最长传输距离分别为185m和500m。一般情况下，10BASE2使用BNC接头，10BASE5使用N型接头</li>
<li>10BASE5直径为9.5mm称为粗缆，10BASE2直径为5mm称为细缆</li>
<li>如今，10Mbps的传输速率已经不能满足网络需求了，所以逐渐被淘汰</li>
</ul>
</li>
<li><p>双绞线</p>
<p>双绞线相较于同轴电缆有更低的制造和部署成本，因此在企业中被广泛应用。</p>
<p>双绞线按照线序可以分为直通线(两头都是568A)，交叉线(一头为568A一头为568B)和全反线(线序相反)，其中直通线连接不同设备，交叉线连接系统设备，全反线一般链接console口</p>
<p>双绞线分为屏蔽双绞线和非屏蔽双绞线。</p>
<ul>
<li>屏蔽双绞线在双绞线与外层绝缘封套之间有一个金属屏蔽层，可以屏蔽电磁干扰</li>
</ul>
<p>双绞线类型较多，不同类型的双绞线支持的传输速率也不同。如：</p>
<ul>
<li>3类双绞线支持10Mbps传输速率</li>
<li>5类双绞线支持100Mbps传输速率</li>
<li>超5类双绞线以及更高级别的双绞线支持千兆以太网。</li>
</ul>
<p>双绞线使用RJ-45接头连接网络设备，其中RJ-45接头中的针脚必须按照一定的线序排列。</p>
<p>如下是部分双绞线类别：</p>
<table>
<thead>
<tr>
<th>以太网标准</th>
<th>线缆类别</th>
<th>最长有效传输距离</th>
</tr>
</thead>
<tbody><tr>
<td>10BASE-T</td>
<td>两对3/4/5类双绞线</td>
<td>100m</td>
</tr>
<tr>
<td>10BASE-TX</td>
<td>两对5类双绞线</td>
<td>100m</td>
</tr>
<tr>
<td>1000BASE-T</td>
<td>四对5e类双绞线</td>
<td>100m</td>
</tr>
</tbody></table>
</li>
<li><p>光纤</p>
<p>之前介绍的双绞线和同轴电缆均是使用电信号进行传输，而光纤传输数据使用的是光信号。</p>
<p>光纤支持的传输速率包括10Mbps、100Mbps、1Gbps、10Gbps甚至更高。</p>
<p>根据光纤传输的光信号模式不同，光纤可分为单模光纤和多模光纤。</p>
<ul>
<li>单模光纤只传输一种模式的光，不存在模间色散，适用于长距离传输。</li>
<li>多模光纤允许不同模式的光在一根光纤上传输，由于模间色散较大导致想好脉冲展宽严重，隐藏适用于局域网短距离传输</li>
</ul>
<p>光纤连接器种类较多，常用的连接器包括ST、FC、SC、LC</p>
<p>如下是部分光纤类别：</p>
<table>
<thead>
<tr>
<th>以太网标准</th>
<th>线缆类别</th>
<th>最长有效传输距离</th>
</tr>
</thead>
<tbody><tr>
<td>10BASE-F</td>
<td>单模/多模光纤</td>
<td>2000m</td>
</tr>
<tr>
<td>100BASE-FX</td>
<td>单模/多模光纤</td>
<td>2000m</td>
</tr>
<tr>
<td>1000BASE-LX</td>
<td>单模/多模光纤</td>
<td>316m</td>
</tr>
<tr>
<td>1000BASE-SX</td>
<td>多模光纤</td>
<td>316m</td>
</tr>
</tbody></table>
</li>
<li><p>串口电缆</p>
<p>网络通信中常用各种串口电缆。常用的串口电缆标准为RS-232也是推荐的标准。但是RS-232的传输速率有限且传输距离仅6米。现在RS-232逐渐被FireWire、USB等标准取代。新产品和设备普遍使用USB标准</p>
</li>
</ol>
<p><strong>冲突域</strong></p>
<p>以太网结构如图</p>
<p><img src="https://pic.imgdb.cn/item/60f048005132923bf8dc3437.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>图中是一个10BASE5以太网，主机都是使用同一根同轴电缆进行通讯，这里的同轴电缆被称为共享介质，相应的网络也被成为共享介质网络。共享网络中，由于不同介质同时发送数据，可能会产生信号冲突。解决该问题的方法一般是采用载波监听多路访问/冲突检测技术(Carrier Sense Multiple Access/Collision Detection)</li>
<li>CSMA/CD的基本工作过程如下∶<ol>
<li>终端设备不停检测共享线路的状态。如果线路空闲，则可以发送数据﹔如果线路不空闲，则等待一段时间后继续检测（延时时间由退避算法决定)</li>
<li>如果有另外一个设备同时发送数据，两个设备发送的数据发送冲突</li>
<li>终端设备检测到冲突之后，马上停止发送自己的数据，并发送特殊阻塞信息，强化冲突信号，使线路上其它站点能够尽早检测到冲突</li>
<li>终端设备检测到冲突后，等待一段时间之后再进行数据发送(延时时间由退避算法决定)</li>
<li>CSMA/CD的工作原理可简单总结为︰先听后发，边发边听，冲突停发，随机延迟后重发。</li>
</ol>
</li>
</ul>
<p><strong>双工模式</strong></p>
<p>双工模式分为以下几种：</p>
<ol>
<li>半双工∶在半双工模式( half-duplex mode)下，通信双方都能发送和接收数据，但不能同时进行。当一台设备发送时，另一台只能接收，反之亦然。对讲机是半双工的典型例子。</li>
<li>全双工︰在全双工模式( full-duplex mode )下，通信双方都能同时接收和发送数据。电话网络是典型的全双工例子。</li>
</ol>
<p>以太网上的通信模式也包括半双工和全双工两种︰</p>
<ol>
<li><p>半双工模式下，共享物理介质的通信双方必须采用CSMA/CD机制来避免冲突。例，10BASE5以太网的通信模式就必须是半双工模式。</p>
</li>
<li><p>全双工模式下，通信双方可以同时实现双向通信，这种模式不会产生冲突，因此不需要使用CSMA/CD机制。例如，10BASE-T以太网的通信模式就可以是全双工模式。</p>
</li>
</ol>
<p>同一物理链路上相连的两台设备的双工模式必须保持一致。</p>
<h2 id="2-以太网帧结构"><a href="#2-以太网帧结构" class="headerlink" title="2. 以太网帧结构"></a>2. 以太网帧结构</h2><p><strong>网络通信协议</strong></p>
<p>  不同的协议栈用于定义和管理不同网络的数据转发规则</p>
<p><strong>OSI模型</strong></p>
<p>OSI模型的优点：简化了相关的网络操作；提供了不同厂商之间的兼容性；促进了标准化工作；结构上进行了分层；易于学习和操作</p>
<ol>
<li>物理层∶在设备之间传输比特流，规定了电平、速度和电缆针脚</li>
<li>数据链路层∶将比特组合成字节，再将字节组合成帧，使用链路层地址（以太网使用MAC地址）来访问介质，并进行差错检测</li>
<li>网络层∶提供逻辑地址，供路由器确定路径</li>
<li>传输层︰提供面向连接或非面向连接的数据传递以及进行重传前的差错检测</li>
<li>会话层︰负责建立、管理和终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和响应组成</li>
<li>表示层∶提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别</li>
<li>应用层∶OSI参考模型中最靠近用户的一层，为应用程序提供网络服务</li>
</ol>
<p><strong>TCP/IP模型</strong></p>
<ol>
<li>TCP/IP模型同样采用了分层结构，层与层相对独立但是相互之间也具备非常密切的协作关系</li>
<li>TCP/IP模型将网络分为四层。TCP/IP模型不关注底层物理介质，主要关注终端之间的逻辑数据流转发。TCP/IP模型的核心是网络层和传输层，网络层解决网络之间的逻辑转发问题，传输层保证源端到目的端之间的可靠传输。最上层的应用层通过各种协议向终端用户提供业务应用</li>
</ol>
<p><strong>数据封装</strong></p>
<p>应用数据需要经过TCP/IP每一层处理之后才能通过网络传输到目的端，每一层上都使用该层的协议数据单元PDU( Protocol Data Unit )彼此交换信息。</p>
<p>不同层的PDU中包含有不同的信息，因此PDU在不同层被赋予了不同的名称。</p>
<p>如上层数据在传输层添加TCP报头后得到的PDU被称为Segment（数据段）；数据段被传递给网络层，网络层添加IP报头得到的PDU被称为Packet(数据包）；数据包被传递到数据链路层，封装数据链路层报头得到的PDU被称为Frame(数据帧）；最后，帧被转换为比特，通过网络介质传输。这种协议栈逐层向下传递数据，并添加报头和报尾的过程称为封装</p>
<p><strong>终端之间的通信</strong></p>
<p>数据包在以太网物理介质上传播之前必须封装头部和尾部信息，封装后的数据包称为数据帧，数据帧中封装的信息决定了数据如何传输。以太网上传输的数据帧有两种格式，选择哪种格式由TCP/IP协议簇中的网络层决定</p>
<p> <strong>帧格式</strong></p>
<p><img src="https://pic.imgdb.cn/item/60f0e5c55132923bf8f38fee.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li><p>以太网上使用两种标准帧格式</p>
<p>第一种是EthernetⅡ帧格式</p>
<p>第二种是1983年提出的IEEE 802.3格式。这两种格式的主要区别在于Ethernet II格式中包含一个Type字段，标识以太帧处理完成之后将被发送到哪个上层协议进行处理，IEEE802.3格式中，同样的位置是长度字段</p>
</li>
<li><p>不同的Type字段值可以用来区别这两种帧的类型，当Type字段值小于等于1500（或者十六进制的0x05DC)时，帧使用的是IEEE 802.3格式。当Type字段值大于等于1536（或者十六进制的0x0600 )时，帧使用的是Ethernet II格式。以太网中大多数的数据帧使用的是Ethernet II格式</p>
</li>
<li><p>以太帧中还包括源和目的MAC地址，分别代表发送者的MAC和接收者的MAC，此外还有帧校验序列字段，用于检验传输过程中帧的完整性</p>
</li>
</ol>
<p><strong>EthernetⅡ帧格式</strong></p>
<p>Ethernet_Ⅱ的帧中各字段说明如下∶</p>
<ol>
<li>DMAC ( Destination MAC)是目的MAC地址。DMAC字段长度为6个字节，标识帧的接收者</li>
<li>SMAC ( Source MAC)是源MAC地址。SMAC字段长度为6个字节，标识帧的发送者</li>
<li>类型字段( Type )用于标识数据字段中包含的高层协议，该字段长度为2个字节。类型字段取值为Ox0800的帧代表P协议帧;类型字段取值为0x0806的帧代表ARP协议帧</li>
<li>数据字段( Data )是网络层数据，最小长度必须为46字节以保证帧长至少为64字节，数据字段的最大长度为1500字节</li>
<li>循环冗余校验字段(FCS)提供了一种错误检测机制。该字段长度为4个字节</li>
</ol>
<p><strong>IEEE 802.3格式</strong></p>
<p>IEEE802.3帧格式类似于Ethernet_Ⅱ帧，只是Ethernet_Ⅱ帧的Type域被802.3帧的Length域取代，并且占用了Data字段的8个字节作为LLC和SNAP字段</p>
<ol>
<li>Length字段定义了Data字段包含的字节数</li>
<li>逻辑链路控制LLC ( Logical Link Control )由目的服务访问点DSAP ( DestinationService Access Point )、源服务访问点SSAP ( Source Service Access Point )和Control字段组成</li>
<li>SNAP ( Sub-network Access Protocol)由机构代码（Org Code )和类型(Type)字段组成。Org Code三个字节都为0。Type字段的含义与Ethernet_I帧中的Type字段相同。IEEE802.3帧根据DSAP和SSAP字段的取值又可分为以下几类︰<ol>
<li>当DSAP和SSAP都取特定值0xff时，802.3帧就变成了Netware-ETHERNET帧，用来承载NetWare类型的数据。</li>
<li>当DSAP和SSAP都取特定值0xaa时，802.3帧就变成了ETHERNET_SNAP帧。ETHERNET_SNAP帧可以用于传输多种协议。</li>
<li>DSAP和SSAP其他的取值均为纯EEE802.3帧。</li>
</ol>
</li>
</ol>
<p><strong>数据帧传输</strong></p>
<p>数据链路层基于MAC地址进行帧传输</p>
<p>以太网在二层链路上通过MAC地址来唯一标识网络设备，并且实现局域网上网络设备之间的通信。MAC地址也叫物理地址，大多数网卡厂商把MAC地址烧入了网卡的ROM中。发送端使用接收端的MAC地址作为目的地址。以太帧封装完成后会通过物理层转换成比特流在物理介质上传输</p>
<p><strong>以太网的MAC地址</strong></p>
<p>每一台网络设备都用物理地址来标识自己，这个地址就是MAC地址。网络设备的MAC地址是全球唯一的。MAC地址长度为48比特，通常用十六进制表示。MAC地址包含两部分︰前24比特是组织唯一标识符(OUI , OrganizationallyUnique Identifier )，由IEEE统一分配给设备制造商。例如，华为的网络产品的MAC地址前24比特是0x00e0fc。后24位序列号是厂商分配给每个产品的唯一数值，由各个厂商自行分配(这里所说的产品可以是网卡或者其他需要MAC地址的设备)</p>
<p><strong>帧的发送方式</strong></p>
<p>局域网上的帧可以通过三种方式发送</p>
<ol>
<li><p>单播</p>
<p>指从单一的源端发送到单一的目的端。每个主机接口由一个MAC地址唯一标识，MAC地址的OUI中，第一字节第8个比特表示地址类型。对于主机MAC地址，这个比特固定为0，表示目的MAC地址为此MAC地址的帧都是发送到某个唯一的目的端。在冲突域中，所有主机都能收到源主机发送的单播帧，但是其他主机发现目的地址与本地MAC地址不一致后会丢弃收到的帧，只有真正的目的主机才会接收并处理收到的帧</p>
</li>
<li><p>广播</p>
<p>表示帧从单一的源发送到共享以太网上的所有主机。广播帧的目的MAC地址为十六进制的FF:FF:FF:FF:FF:FF，所有收到该广播帧的主机都要接收并处理这个帧</p>
<p>广播方式会产生大量流量，导致带宽利用率降低，进而影响整个网络的性能</p>
<p>当需要网络中的所有主机都能接收到相同的信息并进行处理的情况下，通常会使用广播方式</p>
</li>
<li><p>组播</p>
<p>组播比广播更加高效。组播转发可以理解为选择性的广播，主机侦听特定组播地址，接收并处理目的MAC地址为该组播MAC地址的帧</p>
<p>组播MAC地址和单播MAC地址是通过第一字节中的第8个比特区分的。组播MAC地址的第8个比特为1，而单播MAC地址的第8个比特为0</p>
<p>当需要网络上的一组主机(而不是全部主机）接收相同信息，并且其他主机不受影响的情况下通常会使用组播方式</p>
</li>
</ol>
<p><strong>数据帧的发送和接收</strong></p>
<p>帧从主机的物理接口发送出来后，通过传输介质传输到目的端。共享网络中，这个帧可能到达多个主机。主机检查帧头中的目的MAC地址，如果目的MAC地址不是本机MAC地址，也不是本机侦听的组播或广播MAC地址，则主机会丢弃收到的帧</p>
<p>如果目的MAC地址是本机MAC地址，则接收该帧，检查帧校验序列(FCS)字段，并与本机计算的值对比来确定帧在传输过程中是否保持了完整性。如果帧的FCS值与本机计算的值不同，主机会认为帧已被破坏，并会丢弃该帧。如果该帧通过了FCS校验，则主机会根据帧头部中的Type字段来确定将帧发送给上层哪个协议处理。本例中，Type字段的值为0x0800，表明该帧需要发送到IP协议上处理。在发送给IP协议之前，帧的头部和尾部会被剥掉</p>
<h2 id="3-IP编址"><a href="#3-IP编址" class="headerlink" title="3.IP编址"></a>3.IP编址</h2><p>网络层位于数据链路层与传输层之间。网络层中包含了许多协议，其中最为重要的协议就是IP协议。网络层提供了IP路由功能。理解IP路由除了要熟悉IP协议的工作机制之外，还必须理解IP编址以及如何合理地使用IP地址来设计网络</p>
<p>以太帧中的Type字段为0x0800，代表该帧的网络层协议为IP协议</p>
<p><strong>IP报文头部</strong></p>
<p><img src="https://pic.imgdb.cn/item/60f0ea0a5132923bf80c4b15.png" srcset="/img/loading.gif" lazyload alt="IP报文"></p>
<ol>
<li>IP报文头部信息用于指导网络设备对报文进行路由和分片。同一个网段内的数据转发通过链路层即可实现，而跨网段的数据转发需要使用网络设备的路由功能。分片是指数据包超过一定长度时，需要被划分成不同的片段使其能够在网络中传输</li>
<li>IP报文头部长度为20到60字节，报文头中的信息可以用来指导网络设备如何将报文从源设备发送到目的设备。其中，版本字段表示当前支持的IP协议版本，当前的版本号为4。DS字段早期用来表示业务类型，现在用于支持QoS中的差分服务模型，实现网络流量优化</li>
<li>源和目的IP地址是分配主机的逻辑地址，用于在网络层标识报文的发送方和接收方。根据源和目的IP地址可以判断目的端是否与发送端位于同一网段，如果二者不在同一网段，则需要采用路由机制进行跨网段转发</li>
</ol>
<p><strong>IP编址</strong></p>
<ol>
<li>IPv4地址为32比特的二进制数，通常用点分十进制表示。IP地址用来标识网络中的设备，具有IP地址的设备可以在同一网段内或跨网段通信。IP地址包括两部分，第一部分是网络号，表示IP地址所属的网段，第二部分是主机号，用来唯一标识本网段上的某台网络设备</li>
<li>每个网段上都有两个特殊地址不能分配给主机或网络设备。第一个是该网段的网络地址，该IP地址的主机位为全0，表示一个网段。第二个地址是该网段中的广播地址，目的地址为广播地址的报文会被该网段中的所有网络设备接收。广播地址的主机位为全1。除网络地址和广播地址以外的其他IP地址都可以作为网络设备的IP地址</li>
</ol>
<p><strong>IP地址分类</strong></p>
<ol>
<li>IPv4地址被划分为A、B、C、D、E五类，每类地址的网络号包含不同的字节数。A类，B类和C类地址为可分配IP地址，每类地址支持的网络数和主机数不同。比如，A类地址可支持126个网络，每个网络支持224 ( 16,777,216 )个主机地址，另外每个网段中的网络地址和广播地址不能分配给主机。C类地址支持200多万个网络，每个网络支持256个主机地址，其中254个地址可以分配给主机使用</li>
<li>D类地址为组播地址。主机收到以D类地址为目的地址的报文后，且该主机是该组播组成员，就会接收并处理该报文。各类IP地址可以通过第一个字节中的比特位进行区分。如A类地址第一字节的最高位固定为0，B类地址第一字节的高两位固定为10，C类地址第一字节的高三位固定为110，D类地址第一字节的高四位固定为1110，E类地址第一字节的高四位固定为1111</li>
</ol>
<p><strong>IP地址类型</strong></p>
<ol>
<li>私有地址范围<ul>
<li>10.0.0.0~10.255.255.255</li>
<li>172.16.0.0~172.31.255.255</li>
<li>192.168.0.0~192.168.255.255</li>
</ul>
</li>
<li>特殊地址<ul>
<li>127.0.0.0~127.255.255.255</li>
<li>0.0.0.0</li>
<li>255.255.255.255</li>
</ul>
</li>
</ol>
<p>IPv4中的部分IP地址被保留用作特殊用途。为节省IPv4地址，A、B、C类地址段中都预留了特定范围的地址作为私网地址</p>
<p>现在，世界上所有终端系统和网络设备需要的IP地址总数已经超过了32位Pv4地址所能支持的最大地址数4,294,967,296</p>
<p>为主机分配私网地址节省了公网地址，可以用来缓解IP地址短缺的问题</p>
<p>企业网络中普遍使用私网地址，不同企业网络中的私网地址可以重叠</p>
<p>默认情况下，网络中的主机无法使用私网地址与公网通信;当需要与公网通信时，私网地址必须转换成公网地址</p>
<p>还有其他一些特殊IP地址，如127.0.0.0网段中的地址为环回地址，用于诊断网络是否正常。IPv4中的第一个地址0.0.0.0表示任何网络，这个地址的作用将在路由原理中详细介绍。IPv4中的最后一个地址</p>
<p>255.255.255.255是0.0.0.0网络中的广播地址</p>
<p><strong>网络通信</strong></p>
<p>源主机必须要知道目的主机的IP地址后才能将数据发送到目的地</p>
<p>源主机向其他目的主机发送报文之前，需要检查目的IP地址和源IP地址是否属于同一个网段。如果是，则报文将被下发到底层协议进行以太网封装处理。如果目的地址和源地址属于不同网段，则主机需要获取下—跳路由器的IP地址，然后将报文下发到底层协议处理</p>
<p><strong>子网掩码</strong></p>
<p><img src="https://pic.imgdb.cn/item/60f0ee185132923bf82413f1.png" srcset="/img/loading.gif" lazyload></p>
<p>理解上图即可</p>
<p>其中可用主机的减少是因为需要减去网络地址和广播地址</p>
<p><strong>变长子网掩码</strong></p>
<p>理解是对于已经划分的子网掩码进一步划分</p>
<p>案例如下</p>
<p><img src="https://pic.imgdb.cn/item/60f0eecd5132923bf828496c.png" srcset="/img/loading.gif" lazyload></p>
<p>分析需求A段：30，B段：20，C段：10</p>
<p>首先是按照最大的分配，A、B段借3位，子网掩码255.255.255.224每个子网可配置30台，A、B段使用3-1和3-2子网</p>
<p>C段将3-3子网进一步划分</p>
<p>C段借4位，子网掩码255.255.255.240，每个子网可配置14台，用3-3.4-1子网配置</p>
<p>此时有3-4~3-8和3-3.4-2没有使用</p>
<p><strong>无类域间路由</strong></p>
<p><img src="https://pic.imgdb.cn/item/60f0f1ea5132923bf83ad0ba.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li>无类域间路由CIDR ( Classless Inter Domain Routing )由RFC1817定义。CIDR突破了传统IP地址的分类边界，将路由表中的若干条路由汇聚为一条路由，减少了路由表的规模，提高了路由器的可扩展性</li>
<li>如上图所示，一个企业分配到了一段A类网络地址，10.24.0.0/22。该企业准备把这些A类网络分配给各个用户群，目前已经分配了四个网段给用户。如果没有实施CIDR技术，企业路由器的路由表中会有四条下连网段的路由条目，并且会把它通告给其他路由器。通过实施CIDR技术，我们可以在企业的路由器上把这四条路由10.24.0.0/24，10.24.1.0/24,10.24.2.0/24，10.24.3.0/24汇聚成─条路由10.24.0.0/22。这样，企业路由器只需通告10.24.0.0/22这一条路由，大大减小了路由表的规模</li>
</ol>
<p><strong>网关</strong></p>
<p>用来转发不同网段之间的数据包</p>
<ol>
<li>报文转发过程中，首先需要确定转发路径以及通往目的网段的接口，然后将报文封装在以太帧中通过指定的物理接口转发出去。如果目的主机与源主机不在同一网段；报文需要先转发到网关，然后通过网关将报文转发到目的网段</li>
<li>网关是指接收并处理本地网段主机发送的报文并转发到目的网段的设备。为实现此功能，网关必须知道目的网段的IP地址。网关设备上连接本地网段的接口地址即为该网段的网关地址</li>
</ol>
<p><strong>IP包讲解</strong></p>
<p><img src="https://pic.imgdb.cn/item/60f0f2955132923bf83eee4a.png" srcset="/img/loading.gif" lazyload alt="IP包"></p>
<ol>
<li><p>网络中转发的IP报文的长度可以不同，但如果报文长度超过了数据链路所支持的最大长度，则报文就需要分割成若干个较小的片段才能够在链路上传输。将报文分割成多个片段的过程叫做分片</p>
</li>
<li><p>接收端根据分片报文中的标识符(Identification )，标志（Flags)，及片偏移(FragmentOffset )字段对分片报文进行重组</p>
<p>标识符用于识别属于同一个数据包的分片，以区别于同一主机或其他主机发送的其它数据包分片，保证分片被正确的重新组合</p>
<p>标志字段用于判断是否已经收到最后一个分片。最后一个分片的标志字段设置为0，其他分片的标志字段设置为1，目的端在收到标志字段为0的分片后，开始重组报文</p>
<p>片偏移字段表示每个分片在原始报文中的位置。第一个分片的片偏移为0，第二个分片的片偏移表示紧跟第一个分片后的第一个比特的位置。比如，如果首片报文包含1259比特，那么第二分片报文的片偏移字段值就应该为1260</p>
</li>
<li><p><em>生存时间</em></p>
<p>报文在网段间转发时，如果网络设备上的路由规划不合理，就可能会出现环路，导致报文在网络中无限循环，无法到达目的端。环路发生后，所有发往这个目的地的报文都会被循环转发，随着这种报文逐渐增多，网络将会发生拥塞</p>
<p>为避免环路导致的网络拥塞，IP报文头中包含一个生存时间TTL ( Time To Live )字段。报文每经过一台三层设备，TTL值减1。初始TTL值由源端设备设置。当报文中的TTL降为O时，报文会被丢弃。同时，丢弃报文的设备会根据报文头中的源IP地址向源端发送ICMP错误消息</p>
</li>
<li><p><em>协议号</em></p>
<p>目的端的网络层在接收并处理报文以后，需要决定下一步对报文该做如何处理。IP报文头中的协议字段标识了将会继续处理报文的协议。与以太帧头中的Type字段类似，协议字段也是一个十六进制数。该字段可以标识网络层协议，如如CMP ( InternetControl MessageProtocol，因特网控制报文协议），也可以标识上层协议，如TCP (Transmission Control Protocol，传输控制协议，对应值0x06 ) 、UDP ( User Datagram Protocol ,用户数据包协议，对应值0x11 )</p>
</li>
</ol>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">网络基础</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">网络基础</a>
                    
                      <a class="hover-with-bg" href="/tags/TCP-IP%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">TCP/IP基础知识</a>
                    
                  </div>
                
              </div>
              
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-love"></i> <a href="/" target="_blank" rel="nofollow noopener"><span>MyBlog</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
